<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaveX - Tap. Save. Enjoy.</title>
    <style>
        /* (Keep all your existing CSS styles exactly the same) */
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- (Keep all your existing HTML exactly the same) -->

    <script>
class VideoDownloader {
    constructor() {
        this.initializeElements();
        this.bindEvents();
        this.loadHistory();
        this.supportedPlatforms = {
            'youtube.com': 'youtube',
            'youtu.be': 'youtube'
            // Add other platforms when you find working APIs for them
        };
    }

    initializeElements() {
        this.urlInput = document.getElementById('videoUrl');
        this.downloadBtn = document.getElementById('downloadBtn');
        this.historyBtn = document.getElementById('historyBtn');
        this.downloadHistory = document.getElementById('downloadHistory');
        this.historyList = document.getElementById('historyList');
        this.loadingOverlay = document.getElementById('loadingOverlay');
        this.platformIcons = document.querySelectorAll('.platform-icon');
    }

    bindEvents() {
        this.downloadBtn.addEventListener('click', () => this.handleDownload());
        this.urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.handleDownload();
        });
        this.historyBtn.addEventListener('click', () => this.toggleHistory());
        this.platformIcons.forEach(icon => {
            icon.addEventListener('click', () => this.handlePlatformClick(icon));
        });
        this.urlInput.addEventListener('input', () => this.validateInput());
    }

    validateInput() {
        const url = this.urlInput.value.trim();
        const isValid = this.isValidUrl(url);
        this.downloadBtn.style.opacity = isValid ? '1' : '0.6';
        this.downloadBtn.style.cursor = isValid ? 'pointer' : 'not-allowed';
        return isValid;
    }

    isValidUrl(url) {
        if (!url) return false;
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.toLowerCase().replace('www.', '');
            return Object.keys(this.supportedPlatforms).some(platform => 
                hostname.includes(platform)
            );
        } catch {
            return false;
        }
    }

    getPlatformFromUrl(url) {
        try {
            const urlObj = new URL(url);
            const hostname = urlObj.hostname.toLowerCase().replace('www.', '');
            for (const [platform, name] of Object.entries(this.supportedPlatforms)) {
                if (hostname.includes(platform)) {
                    return name;
                }
            }
        } catch {
            return null;
        }
        return null;
    }

    async handleDownload() {
        const url = this.urlInput.value.trim();
        if (!this.isValidUrl(url)) {
            this.showError('Please enter a valid URL from supported platforms');
            return;
        }

        const platform = this.getPlatformFromUrl(url);
        if (!platform) {
            this.showError('Platform not supported');
            return;
        }

        this.showLoading();

        try {
            // For YouTube, we'll use a simple proxy service
            if (platform === 'youtube') {
                const videoId = this.extractYouTubeId(url);
                if (!videoId) throw new Error('Invalid YouTube URL');
                
                // Using a free CORS proxy to fetch download info
                const response = await fetch(`https://cors-anywhere.herokuapp.com/https://yt5s.io/api/ajaxSearch?q=${videoId}`);
                const data = await response.json();
                
                if (!data.links) throw new Error('No download links found');
                
                // Get the highest quality MP4 link
                const downloadLink = data.links.mp4['720p'] || data.links.mp4['360p'];
                if (!downloadLink) throw new Error('No downloadable version found');
                
                // Trigger the download
                window.open(downloadLink, '_blank');
            }

            this.addToHistory(url, platform);
            this.showSuccess(platform);
            this.urlInput.value = '';
            this.validateInput();
            
        } catch (error) {
            this.showError(error.message || 'Download failed. Please try again.');
        } finally {
            this.hideLoading();
        }
    }

    extractYouTubeId(url) {
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    showLoading() {
        this.loadingOverlay.style.display = 'flex';
        this.downloadBtn.disabled = true;
    }

    hideLoading() {
        this.loadingOverlay.style.display = 'none';
        this.downloadBtn.disabled = false;
    }

    showSuccess(platform) {
        const notification = this.createNotification(
            `✅ Video from ${platform.charAt(0).toUpperCase() + platform.slice(1)} downloaded successfully!`,
            'success'
        );
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    showError(message) {
        const notification = this.createNotification(`❌ ${message}`, 'error');
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 4000);
    }

    createNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        Object.assign(notification.style, {
            position: 'fixed',
            top: '20px',
            right: '20px',
            padding: '1rem 1.5rem',
            borderRadius: '12px',
            color: 'white',
            fontWeight: '500',
            fontSize: '0.875rem',
            zIndex: '1001',
            maxWidth: '300px',
            wordWrap: 'break-word',
            boxShadow: '0 10px 25px rgba(0, 0, 0, 0.3)',
            animation: 'slideIn 0.3s ease-out',
            background: type === 'success' ? 
                'linear-gradient(135deg, #10b981, #059669)' : 
                'linear-gradient(135deg, #ef4444, #dc2626)'
        });
        return notification;
    }

    handlePlatformClick(icon) {
        const platform = icon.dataset.platform;
        icon.style.transform = 'scale(0.95)';
        setTimeout(() => icon.style.transform = '', 150);

        const platformNames = {
            instagram: 'Instagram',
            youtube: 'YouTube',
            facebook: 'Facebook',
            tiktok: 'TikTok',
            twitter: 'Twitter/X',
            vimeo: 'Vimeo'
        };

        const notification = this.createNotification(
            `📱 Paste a ${platformNames[platform]} video URL to download`,
            'info'
        );
        notification.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 2500);
        this.urlInput.focus();
    }

    toggleHistory() {
        const isVisible = this.downloadHistory.style.display !== 'none';
        this.downloadHistory.style.display = isVisible ? 'none' : 'block';
        this.historyBtn.innerHTML = isVisible ? 
            '<svg class="history-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>History' :
            '<svg class="history-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>Close';
    }

    addToHistory(url, platform) {
        const history = this.getStoredHistory();
        const newEntry = {
            id: Date.now(),
            url: url,
            platform: platform,
            timestamp: new Date().toISOString(),
            displayTime: new Date().toLocaleString()
        };
        history.unshift(newEntry);
        if (history.length > 20) history.splice(20);
        localStorage.setItem('videoDownloadHistory', JSON.stringify(history));
        this.renderHistory();
    }

    getStoredHistory() {
        try {
            return JSON.parse(localStorage.getItem('videoDownloadHistory')) || [];
        } catch {
            return [];
        }
    }

    loadHistory() {
        this.renderHistory();
    }

    renderHistory() {
        const history = this.getStoredHistory();
        this.historyList.innerHTML = history.length === 0 ? 
            '<p class="no-history">No downloads yet</p>' :
            history.map(entry => `
                <div class="history-item">
                    <div class="history-item-info">
                        <div class="history-item-url">${this.truncateUrl(entry.url)}</div>
                        <div class="history-item-time">${entry.displayTime} • ${entry.platform}</div>
                    </div>
                </div>
            `).join('');
    }

    truncateUrl(url, maxLength = 40) {
        return url.length <= maxLength ? url : url.substring(0, maxLength - 3) + '...';
    }
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    .notification { animation: slideIn 0.3s ease-out; }
`;
document.head.appendChild(style);

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
    new VideoDownloader();
    
    // Add subtle parallax effect
    document.addEventListener('mousemove', (e) => {
        const mouseX = e.clientX / window.innerWidth;
        const mouseY = e.clientY / window.innerHeight;
        document.body.style.background = `
            linear-gradient(
                ${135 + mouseX * 10}deg, 
                hsl(${220 + mouseY * 10}, 15%, ${10 + mouseY * 5}%) 0%, 
                hsl(${220 + mouseX * 10}, 20%, ${16 + mouseX * 5}%) 100%
            )`;
    });
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('videoUrl').focus();
        }
        if (e.key === 'Escape') {
            const history = document.getElementById('downloadHistory');
            if (history.style.display !== 'none') {
                history.style.display = 'none';
                document.getElementById('historyBtn').innerHTML = 
                    '<svg class="history-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>History';
            }
        }
    });
});
    </script>
</body>
</html>
